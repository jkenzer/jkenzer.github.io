const data = {
  records: [
    {
      Id: "a0r23000000SwMNAA0",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r23000000T0erAAC",
      Grant__r: {
        Program_Area__c: "4",
        Philanthropic_Agenda_Area__c: "Environment/Species Protection",
        Sub_Program_Area__c: "C",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000004EIRZAA4",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006FiBWAA0",
      Grant__r: {
        Program_Area__c: "4",
        Philanthropic_Agenda_Area__c: "Environment/Species Protection",
        Sub_Program_Area__c: "D",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006FvOOAA0",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006G3HVAA0",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006G3HfAAK",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 600,
    },
    {
      Id: "a0r3k000006GGm7AAG",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006GGmBAAW",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006GGmFAAW",
      Grant__r: {
        Program_Area__c: "4",
        Philanthropic_Agenda_Area__c: "Environment/Species Protection",
        Sub_Program_Area__c: "C",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006GGqJAAW",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006GNfWAAW",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006Gb4CAAS",
      Grant__r: {
        Program_Area__c: "4",
        Philanthropic_Agenda_Area__c: "Environment/Species Protection",
        Sub_Program_Area__c: "C",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006H1XGAA0",
      Grant__r: {
        Program_Area__c: "2",
        Philanthropic_Agenda_Area__c:
          "Community/Neighborhood/Economic Development",
        Sub_Program_Area__c: "S",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006H4lTAAS",
      Grant__r: {
        Program_Area__c: null,
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: null,
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006H5VMAA0",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "E",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006H5VNAA0",
      Grant__r: {
        Program_Area__c: null,
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: null,
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006H5VOAA0",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006H5VPAA0",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "L",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006H5VQAA0",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "L",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006H92HAAS",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "G",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006HBFDAA4",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "E",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006HBFEAA4",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "K",
      },
      Grant_Amount__c: 2500,
    },
    {
      Id: "a0r3k000006HBQNAA4",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006HBQOAA4",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 2000,
    },
    {
      Id: "a0r3k000006HbD0AAK",
      Grant__r: {
        Program_Area__c: null,
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: null,
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006HbD3AAK",
      Grant__r: {
        Program_Area__c: null,
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: null,
      },
      Grant_Amount__c: 600,
    },
    {
      Id: "a0r3k000006VHWaAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWbAAO",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWcAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 250,
    },
    {
      Id: "a0r3k000006VHWdAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWeAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWfAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWgAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWhAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWiAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "K",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWjAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWkAAO",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 250,
    },
    {
      Id: "a0r3k000006VHWlAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWmAAO",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWnAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWoAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: -1000,
    },
    {
      Id: "a0r3k000006VHWpAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWqAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWrAAO",
      Grant__r: {
        Program_Area__c: "4",
        Philanthropic_Agenda_Area__c: "Environment/Species Protection",
        Sub_Program_Area__c: "C",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWsAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWtAAO",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWuAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWvAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWwAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWxAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "K",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHWyAAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHWzAAO",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX0AAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "K",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX1AAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX2AAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "5",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHX3AAO",
      Grant__r: {
        Program_Area__c: "4",
        Philanthropic_Agenda_Area__c: "Environment/Species Protection",
        Sub_Program_Area__c: "C",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX4AAO",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 500,
    },
    {
      Id: "a0r3k000006VHX5AAO",
      Grant__r: {
        Program_Area__c: "8",
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: "Z103",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX6AAO",
      Grant__r: {
        Program_Area__c: "8",
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: "Z103",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX7AAO",
      Grant__r: {
        Program_Area__c: "8",
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: "Z103",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX8AAO",
      Grant__r: {
        Program_Area__c: "8",
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: "Z103",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHX9AAO",
      Grant__r: {
        Program_Area__c: "8",
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: "Z103",
      },
      Grant_Amount__c: 1000,
    },
    {
      Id: "a0r3k000006VHXAAA4",
      Grant__r: {
        Program_Area__c: "8",
        Philanthropic_Agenda_Area__c: "Unknown",
        Sub_Program_Area__c: "Z103",
      },
      Grant_Amount__c: 4000,
    },
    {
      Id: "a0r3k000006VrpqAAC",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "O",
      },
      Grant_Amount__c: 250,
    },
    {
      Id: "a0r3k000006WRlPAAW",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "G",
      },
      Grant_Amount__c: 250,
    },
    {
      Id: "a0r3k000006WXN0AAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "E",
      },
      Grant_Amount__c: 250,
    },
    {
      Id: "a0r3k000006WXN1AAO",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "K",
      },
      Grant_Amount__c: 2500,
    },
    {
      Id: "a0r3k000006WXhPAAW",
      Grant__r: {
        Program_Area__c: "5",
        Philanthropic_Agenda_Area__c: "Health/Human Services",
        Sub_Program_Area__c: "P",
      },
      Grant_Amount__c: 2500,
    },
    {
      Id: "a0r3k000007F2HgAAK",
      Grant__r: {
        Program_Area__c: "1",
        Philanthropic_Agenda_Area__c: "Arts/Culture",
        Sub_Program_Area__c: "A",
      },
      Grant_Amount__c: 1000,
    },
  ],
};

const svgWidth = window.innerWidth;
const svgHeight = window.innerHeight;

function Sunburst(
  data,
  {
    // data is either tabular (array of objects) or hierarchy (nested objects)
    path, // as an alternative to id and parentId, returns an array identifier, imputing internal nodes
    id = Array.isArray(data) ? (d) => d.id : null, // if tabular data, given a d in data, returns a unique identifier (string)
    parentId = Array.isArray(data) ? (d) => d.parentId : null, // if tabular data, given a node d, returns its parent’s identifier
    children, // if hierarchical data, given a d in data, returns its children
    value, // given a node d, returns a quantitative value (for area encoding; null for count)
    sort = (a, b) => d3.descending(a.value, b.value), // how to sort nodes prior to layout
    label, // given a node d, returns the name to display on the rectangle
    title, // given a node d, returns its hover text
    link, // given a node d, its link (if any)
    linkTarget = "_blank", // the target attribute for links (if any)
    width = 640, // outer width, in pixels
    height = 400, // outer height, in pixels
    margin = 1, // shorthand for margins
    marginTop = margin, // top margin, in pixels
    marginRight = margin, // right margin, in pixels
    marginBottom = margin, // bottom margin, in pixels
    marginLeft = margin, // left margin, in pixels
    padding = 1, // separation between arcs
    radius = Math.min(
      width - marginLeft - marginRight,
      height - marginTop - marginBottom
    ) / 2, // outer radius
    color = d3.interpolateRainbow, // color scheme, if any
    fill = "#ccc", // fill for arcs (if no color encoding)
    fillOpacity = 0.6, // fill opacity for arcs
  } = {}
) {
  const svg = d3.select(".d3");

  // If id and parentId options are specified, or the path option, use d3.stratify
  // to convert tabular data to a hierarchy; otherwise we assume that the data is
  // specified as an object {children} with nested objects (a.k.a. the “flare.json”
  // format), and use d3.hierarchy.
  const root =
    path != null
      ? d3.stratify().path(path)(data)
      : id != null || parentId != null
      ? d3.stratify().id(id).parentId(parentId)(data)
      : d3.hierarchy(data, children);

  // Compute the values of internal nodes by aggregating from the leaves.
  value == null ? root.count() : root.sum((d) => Math.max(0, value(d)));

  // Sort the leaves (typically by descending value for a pleasing layout).
  if (sort != null) root.sort(sort);

  // Compute the partition layout. Note polar coordinates: x is angle and y is radius.
  d3.partition().size([2 * Math.PI, radius])(root);

  // Construct a color scale.
  if (color != null) {
    color = d3.scaleSequential([0, root.children.length], color).unknown(fill);
    root.children.forEach((child, i) => (child.index = i));
  }

  // Construct an arc generator.
  const arc = d3
    .arc()
    .startAngle((d) => d.x0)
    .endAngle((d) => d.x1)
    .padAngle((d) => Math.min((d.x1 - d.x0) / 2, (2 * padding) / radius))
    .padRadius(radius / 2)
    .innerRadius((d) => d.y0)
    .outerRadius((d) => d.y1 - padding);

  svg
    .attr("viewBox", [
      marginRight - marginLeft - width / 2,
      marginBottom - marginTop - height / 2,
      width,
      height,
    ])
    .attr("width", width)
    .attr("height", height)
    .attr("style", "max-width: 100%; height: auto; height: intrinsic;")
    .attr("font-family", "sans-serif")
    .attr("font-size", 10)
    .attr("text-anchor", "middle");

  const cell = svg.selectAll("a").data(root.descendants()).join("a");
  // .attr("xlink:href", link == null ? null : (d) => link(d.data, d))
  // .attr("target", link == null ? null : linkTarget);

  cell
    .append("path")
    .attr("d", arc)
    .attr(
      "fill",
      color ? (d) => color(d.ancestors().reverse()[1]?.index) : fill
    )
    .attr("fill-opacity", fillOpacity);

  if (label != null)
    cell
      .filter((d) => ((d.y0 + d.y1) / 2) * (d.x1 - d.x0) > 10)
      .append("text")
      .attr("transform", (d) => {
        if (!d.depth) return;
        const x = (((d.x0 + d.x1) / 2) * 180) / Math.PI;
        const y = (d.y0 + d.y1) / 2;
        return `rotate(${x - 90}) translate(${y},0) rotate(${
          x < 180 ? 0 : 180
        })`;
      })
      .attr("dy", "0.32em")
      .text((d) => label(d.data, d));

  cell.selectAll("text").call(wrap, 25);

  if (title != null) cell.append("title").text((d) => title(d.data, d));

  return svg.node();
}

const grantData = getGrantData();
console.log(grantData);

const chart = Sunburst(grantData, {
  value: (d) => d.size, // size of each node (file); null for internal nodes (folders)
  label: (d) => `${d.name}${d.size ? " - $" + d.size : ""}`, // display name for each cell
  title: (d, n) =>
    `${n
      .ancestors()
      .reverse()
      .map((d) => d.data.name)
      .join(".")}\n$${n.value.toLocaleString("en")}`, // hover text
  link: (d, n) => (n.children ? `` : ``),
  width: svgWidth,
  height: svgHeight,
});

function getGrantData() {
  const formattedData = {
    name: `Agenda Areas`,
    children: [],
  };
  const records = data.records;
  let parents = [];
  records.forEach((rec) => {
    const found = parents.findIndex(
      ({ name }) => name == rec.Grant__r.Philanthropic_Agenda_Area__c
    );
    if (found < 0) {
      parents.push({
        name: rec.Grant__r.Philanthropic_Agenda_Area__c,
        // size: rec.Grant_Amount__c,
      });
    }
  });
  parents.forEach((p, i) => {
    let children = records.filter((r) => {
      return r.Grant__r.Philanthropic_Agenda_Area__c == p.name;
    });

    let dupeChildren = children.map((child) => {
      return {
        name: child.Grant__r.Program_Area__c || "unknown",
        size: child.Grant_Amount__c,
      };
    });
    let finalChildren = [];
    dupeChildren.forEach((dc) => {
      const found = finalChildren.findIndex(({ name }) => name == dc.name);
      if (found < 0) {
        finalChildren.push({
          name: dc.name,
          size: dc.size,
        });
      } else {
        finalChildren[found].size = finalChildren[found].size + dc.size;
      }
    });
    // console.log(finalChildren);
    parents[i].children = finalChildren;
  });
  // console.log(parents);
  formattedData.children = parents;
  return formattedData;
}

function wrap(text, width) {
  text.each(function () {
    var text = d3.select(this),
      words = text.text().split(/\s+/).reverse(),
      word,
      line = [],
      lineNumber = 0,
      lineHeight = 0.5, // ems
      y = text.attr("y"),
      dy = parseFloat(text.attr("dy")),
      tspan = text
        .text(null)
        .append("tspan")
        .attr("x", 0)
        .attr("y", y)
        .attr("dy", dy + "em");
    while ((word = words.pop())) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text
          .append("tspan")
          .attr("x", 0)
          .attr("y", y)
          .attr("dy", `${++lineNumber * lineHeight + dy}em`)
          .text(word);
      }
    }
  });
}
